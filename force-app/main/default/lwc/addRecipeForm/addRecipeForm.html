<template>
  <lightning-card title="New Recipe">
    <div>
      <label class="slds-form-element__label">Recipe Name</label>
      <lightning-input id="recipeName" name="recipeName" onchange={handleRecipeNameChange}></lightning-input>
      <p> -------------------------------------------------------------------- </p>
    </div>

    <div class="slds-form-element">
      <label class="slds-form-element__label">Ingredients</label>
      <div class="slds-form-element__control">

        <template for:each={ingredients} for:item="ingredient">
          <div key={ingredient.id}>
            <lightning-input data-index={ingredient.id} checked={ingredient.isProduct} type="checkbox" label="Product" onchange={handleIsProductChange}></lightning-input>
            <lightning-input data-index={ingredient.id} checked={ingredient.isRecipe} type="checkbox" label="Recipe" onchange={handleIsRecipeChange}></lightning-input>
            <template lwc:if={ingredient.isProduct}>
              <div>

                <!-- <lightning-record-edit-form object-api-name="Ingredient__c" onsuccess={handleSuccess}>
                  <lightning-messages></lightning-messages>
                  <lightning-input-field data-index={ingredient.id} field-name="Product__c"
                    onchange={handleProductChoice}></lightning-input-field>
                </lightning-record-edit-form> -->

                <p>Create new Product: </p>

                <input data-index={ingredient.id} type="text" value={ingredient.newProduct}
                  oninput={handleIngredientNameChange}></input>
                <input data-index={ingredient.id} type="number" value={ingredient.quantity}
                  oninput={handleQuantityChange}></input>
                <lightning-button data-index={ingredient.id} label="Remove" variant="destructive"
                  onclick={removeIngredients}></lightning-button>
              </div>
            </template>

            <template lwc:else>
              <div>
                <lightning-record-edit-form object-api-name="Ingredient__c" onsuccess={handleSuccess}>
                  <lightning-messages></lightning-messages>
                  <lightning-input-field data-index={ingredient.id} field-name="Recipe__c"
                    onchange={handleRecipeChoice}></lightning-input-field>
                </lightning-record-edit-form>
                <input data-index={ingredient.id} type="number" value={ingredient.quantity}
                  oninput={handleQuantityChange}></input>
                <lightning-button data-index={ingredient.id} label="Remove" variant="destructive"
                  onclick={removeIngredients}></lightning-button>
              </div>
            </template>
          </div>
        </template>

        <lightning-button label="Add Ingredient" variant="brand" onclick={addMoreIngredients}></lightning-button>
      </div>

    </div>

    <lightning-button variant="brand" label="Save" title="Primary action" onclick={saveRecipe}
      class="slds-m-left_x-small"></lightning-button>
  </lightning-card>
</template>